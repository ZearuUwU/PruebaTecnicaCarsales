<app-episode-player *ngIf="selectedEpisode()" [episode]="selectedEpisode()" (closePlayer)="selectedEpisode.set(null)">
</app-episode-player>

<div class="main-layout">

  <aside class="sidebar">
    <div class="header-section">
      <h1>Rick<span>BFF</span></h1>
      <p class="subtitle">Explorador de Episodios</p>
    </div>

    <div class="filter-container">
      <h3>Filtros</h3>

      <div class="filter-group">
        <label>ğŸ” Buscar</label>
        <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event); currentPage.set(1)"
          placeholder="Nombre o CÃ³digo (S01E01)...">
      </div>

      <div class="filter-group">
        <label>ğŸ¬ Temporada</label>
        <select [ngModel]="selectedSeason()" (ngModelChange)="selectedSeason.set($event); currentPage.set(1)">
          <option value="All">Todas</option>
          <option value="1">Temporada 1</option>
          <option value="2">Temporada 2</option>
          <option value="3">Temporada 3</option>
          <option value="4">Temporada 4</option>
          <option value="5">Temporada 5</option>
        </select>
      </div>

      <div class="filter-group date-range">
        <label>ğŸ“… Fecha EmisiÃ³n</label>
        <div class="date-inputs">
          <input type="date" [ngModel]="startDate()" (ngModelChange)="startDate.set($event); currentPage.set(1)"
            title="Desde">
          <span class="separator">-</span>
          <input type="date" [ngModel]="endDate()" (ngModelChange)="endDate.set($event); currentPage.set(1)"
            title="Hasta">
        </div>
      </div>

      <button class="reset-btn" (click)="resetFilters()">
        Limpiar Filtros
      </button>
    </div>

    <div class="stats">
      <p>Mostrando: <strong>{{ filteredEpisodes().length }}</strong></p>
      <p>Vistos: <strong>{{ seenEpisodes().size }}</strong></p>
    </div>
  </aside>

  <main class="content">
    @if (paginatedEpisodes().length > 0) {
    <div class="grid-container">
      @for (ep of paginatedEpisodes(); track ep.id) {
      <app-episode-card [episode]="ep" [isSeen]="isSeen(ep.id)" (onOpen)="openPlayer($event)"></app-episode-card>
      }
    </div>

    <div class="pagination" *ngIf="totalPages() > 1">
      <button (click)="prevPage()" [disabled]="currentPage() === 1">â† Anterior</button>
      <span>PÃ¡gina {{ currentPage() }} de {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">Siguiente â†’</button>
    </div>
    } @else {
    <div class="empty-state">
      <div class="placeholder-icon">ğŸ›¸</div>
      <h2>No encontramos episodios</h2>
      <p>Intenta ajustar los filtros de bÃºsqueda.</p>
      <button (click)="resetFilters()">Ver todos</button>
    </div>
    }
  </main>
</div>