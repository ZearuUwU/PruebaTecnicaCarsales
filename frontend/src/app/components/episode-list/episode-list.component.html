<app-episode-player *ngIf="selectedEpisode()" [episode]="selectedEpisode()" (closePlayer)="selectedEpisode.set(null)">
</app-episode-player>

<div class="main-layout">

  <aside class="sidebar">
    <div class="header-section">
      <h1>Rick<span>BFF</span></h1>
      <p class="subtitle">Explorador de Episodios</p>
      <a routerLink="/characters" class="nav-link">→ Ver Personajes</a>
    </div>

    <div class="filter-container">
      <h3>Filtros</h3>

      <div class="filter-group">
        <label>Buscar</label>
        <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event); onFilterChange()"
          placeholder="Nombre o Código (S01E01)...">
      </div>

      <div class="filter-group">
        <label>Temporada</label>
        <select [ngModel]="selectedSeason()" (ngModelChange)="selectedSeason.set($event); onFilterChange()">
          <option value="All">Todas</option>
          <option value="1">Temporada 1</option>
          <option value="2">Temporada 2</option>
          <option value="3">Temporada 3</option>
          <option value="4">Temporada 4</option>
          <option value="5">Temporada 5</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Emisión (Mes/Año)</label>
        <input type="month" [ngModel]="startDate()" (ngModelChange)="startDate.set($event); onFilterChange()"
          title="Selecciona Mes y Año">
      </div>

      <button class="reset-btn" (click)="resetFilters()">
        Limpiar Filtros
      </button>
    </div>

    <div class="stats">
      <p>Mostrando en página: <strong>{{ episodes().length }}</strong></p>
      <p>Total Resultados: <strong>{{ totalItems() }}</strong></p>
      <p>Vistos: <strong>{{ seenEpisodes().size }}</strong></p>
    </div>
  </aside>

  <main class="content">
    @if (episodes().length > 0) {
    <div class="grid-container">
      @for (ep of episodes(); track ep.id) {
      <app-episode-card [episode]="ep" [isSeen]="isSeen(ep.id)" (onOpen)="openPlayer($event)"></app-episode-card>
      }
    </div>

    <div class="pagination" *ngIf="totalPages() > 1">
      <button (click)="prevPage()" [disabled]="currentPage() === 1">← Anterior</button>
      <span>Página {{ currentPage() }} de {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">Siguiente →</button>
    </div>
    } @else {
    <div class="empty-state">
      <div class="placeholder-icon"></div>
      <h2>No encontramos episodios</h2>
      <p>Intenta ajustar los filtros de búsqueda.</p>
      <button (click)="resetFilters()">Ver todos</button>
    </div>
    }
  </main>
</div>